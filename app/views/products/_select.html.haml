/ - @products = Product.where(:collection_id => f.object.collection_id) unless !defined?(f)

- if defined?(f) && f.object.products
  - @products = Product.where(:collection_id => f.object.collection_id)
  / - f.object.products.each do |product|
  - @products.each do |product|
    .checkbox
      = check_box_tag "product#{product.id}", product.id, f.object.products.include?(product), :name => 'compilation[product_ids][]'
      = label_tag "product#{product.id}", product.title
- else 
  - if defined?(@products)
    - @products.each do |product|
      .checkbox
        = check_box_tag "product#{product.id}", product.id, false, :name => 'compilation[product_ids][]'
        = label_tag "product#{product.id}", product.title
  - else 
    Please select a "Collection" above.